<div>
  <div class="result-container">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>You requested for...</mat-panel-title>
      </mat-expansion-panel-header>
      <vc-editor [editable]="false" [code]="presentationQuery"></vc-editor>
    </mat-expansion-panel>

    <div class="documents-and-log">
      <span>...and wallet responded with the following documents ...</span>
      <a mat-button (click)="openLogs()">transaction log</a>
    </div>

    @for (entry of attestationsPerQuery | keyvalue; track entry) {
      <mat-expansion-panel expanded="true">
        <mat-expansion-panel-header>
          <mat-panel-title><span>for query <strong>{{ entry.key }}</strong>:</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      @if (entry.value | async; as attestations) {
        <div>
          <strong>{{ attestations.length }}</strong> documents
        </div>
        <div class="result-container">
          @for (attestation of attestations; track attestation) {
            @if (isErrored(attestation)) {
              <mat-card appearance="outlined">
                <mat-card-header>
                  <mat-card-title
                    >Error: {{ attestation.reason }}</mat-card-title
                    >
                    <mat-card-subtitle>
                      in
                      <i> {{ attestation.format }} </i> format</mat-card-subtitle
                      >
                    </mat-card-header>
                  </mat-card>
                }
                @if (!isErrored(attestation)) {
                  <mat-card appearance="outlined">
                    <mat-card-header>
                      <mat-card-title>{{ attestation.name }}</mat-card-title>
                      <mat-card-subtitle>
                        in
                        <i> {{ attestation.format }} </i> format</mat-card-subtitle
                        >
                      </mat-card-header>
                      <mat-card-actions align="end">
                        <button
                          mat-stroked-button
                          (click)="viewContents(attestation)"
                          >
                          View Content
                        </button>
                      </mat-card-actions>
                    </mat-card>
                  }
                }
              </div>
            }
          </mat-expansion-panel>
        }
      </div>
    </div>
